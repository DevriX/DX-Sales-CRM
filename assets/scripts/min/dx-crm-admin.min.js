function dx_crm_valid_email(a){var b=1,c=/^(com|net|org|edu|int|mil|gov|arpa|biz|aero|name|coop|info|pro|museum)$/,d=/^(.+)@(.+)$/,e='\\(\\)><@,;:\\\\\\"\\.\\[\\]',f="[^\\s"+e+"]",g='("[^"]*")',h=/^\[(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})\]$/,i=f+"+",j="("+i+"|"+g+")",k=new RegExp("^"+j+"(\\."+j+")*$"),l=(new RegExp("^"+i+"(\\."+i+")*$"),a.match(d));if(null==l)return!1;var m=l[1],n=l[2];for(p=0;p<m.length;p++)if(m.charCodeAt(p)>127)return!1;for(p=0;p<n.length;p++)if(n.charCodeAt(p)>127)return!1;if(null==m.match(k))return!1;var o=n.match(h);if(null!=o){for(var p=1;p<=4;p++)if(o[p]>255)return alert("Destination IP address is invalid!"),!1;return!0}var q=new RegExp("^"+i+"$"),r=n.split("."),s=r.length;for(p=0;p<s;p++)if(r[p].search(q)==-1)return!1;return(!b||2==r[r.length-1].length||r[r.length-1].search(c)!=-1)&&!(s<2)}function IsNumeric(a){return a-0==a&&(""+a).replace(/^\s+|\s+$/g,"").length>0}jQuery(document).ready(function(a){jQuery(".inline-editor").livequery(function(){var b=jQuery(this).attr("id");if(b=b.replace(/^edit-/,""),b&&parseInt(b)){var c=jQuery("#inline_"+b+"_assign_customers").text(),d=jQuery("#inline_"+b+"_pro_customer").text(),e=c.split(","),f=d.split(",");a(".crm-user-check").removeAttr("checked","checked"),a(".crm-customer-check").removeAttr("selected","selected"),"undefined"!=typeof e&&a.each(e,function(b,c){a("#crm_user_"+c).attr("checked","checked")}),"undefined"!=typeof f&&a.each(f,function(b,c){a("#crm_customer_"+c).attr("selected","selected")})}}),jQuery(".dx-crm-meta-datetime").datepicker({dateFormat:"yy-mm-dd",changeYear:!0,changeMonth:!0,minDate:new Date}),a("#dxcrm_pro_start_date").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"yy-mm-dd",minDate:a("#dxcrm_pro_start_date").val()?a("#dxcrm_pro_start_date").val():new Date,onClose:function(b){var c=new Date(b);c<new Date&&(c=new Date),a("#dxcrm_pro_end_date").datepicker("option","minDate",c)}}),a("#dxcrm_pro_end_date").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"yy-mm-dd",minDate:new Date,onClose:function(b){var c=a("#dxcrm_pro_start_date").val();c&&a("#dxcrm_pro_start_date").datepicker("option","minDate",c),a("#dxcrm_pro_start_date").datepicker("option","maxDate",b)}}),a("#dxcrm_pro_real_end_date_first_mile").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"yy-mm-dd",minDate:new Date(a("#dxcrm_pro_real_end_date_first_mile").val())<new Date?a("#dxcrm_pro_real_end_date_first_mile").val():new Date}),a("#dxcrm_pro_real_end_date_last_conversation").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"yy-mm-dd",minDate:new Date(a("#dxcrm_pro_real_end_date_last_conversation").val())<new Date?a("#dxcrm_pro_real_end_date_last_conversation").val():new Date}),a("#dxcrm_cust_contact_date").datepicker({changeMonth:!0,numberOfMonths:1,dateFormat:"yy-mm-dd"}),jQuery(".dx-crm-meta-time-picker").timepicker({ampm:!0}),a(".dx_crm_pro_name_error").html("").hide(),a(".dx_crm_pro_cost_error").html("").hide(),a(".dx_crm_mile_name_error").html("").hide(),a(".dx_crm_mile_extra_cost_error").html("").hide(),a(".dx_crm_emp_name_error").html("").hide(),a(".dx_crm_emp_email_error").html("").hide(),a(".dx_crm_hourly_rate_error").html("").hide(),a(".dx_crm_comp_cost_error").html("").hide();a(document).on("click","#publish",function(){if(a(".dx-crm-mile-name").is(":visible")){if(a(".dx_crm_mile_name_error").html("").hide(),a(".dx_crm_mile_extra_cost_error").html("").hide(),mile_name=a(".dx-crm-mile-name").val(),extra_cost=a("#dx_crm_mile_extra_cost").val(),""==mile_name){a(".dx_crm_mile_name_error").html("Please enter milestone name.").show();var b="true"}if(""!=extra_cost&&0==IsNumeric(extra_cost)){a(".dx_crm_mile_extra_cost_error").html("Please enter valid extra cost.").show();var b="true"}if("true"==b){a(this).parent().find(".spinner").hide(),a(this).removeClass("button-primary-disabled");var c=a("#crm_meta_milestone");return a("html, body").animate({scrollTop:c.offset().top-50},500),!1}}if(a(".dx-crm-emp-name").is(":visible")){if(a(".dx_crm_emp_name_error").html("").hide(),a(".dx_crm_emp_email_error").html("").hide(),a(".dx_crm_hourly_rate_error").html("").hide(),emp_name=a(".dx-crm-emp-name").val(),emp_email=a("#dx_crm_emp_email").val(),hourly_rate=a("#dx_crm_emp_hourly_rate").val(),""==emp_name){a(".dx_crm_emp_name_error").html("Please enter employee name.").show();var b="true"}if(""!=emp_email&&!dx_crm_valid_email(emp_email)){a(".dx_crm_emp_email_error").html("Please enter valid email.").show();var b="true"}if(""!=hourly_rate&&0==IsNumeric(hourly_rate)){a(".dx_crm_hourly_rate_error").html("Please enter valid hourly rate.").show();var b="true"}if("true"==b){a(this).parent().find(".spinner").hide(),a(this).removeClass("button-primary-disabled");var c=a("#crm_meta_staff");return a("html, body").animate({scrollTop:c.offset().top-50},500),!1}}if(a(".com_exp").is(":visible")){if(a(".dx_crm_comp_cost_error").html("").hide(),comp_cost=a("#dx_crm_comp_cost").val(),""!=comp_cost&&0==IsNumeric(comp_cost)){a(".dx_crm_comp_cost_error").html("Please enter valid cost.").show();var b="true"}if("true"==b){a(this).parent().find(".spinner").hide(),a(this).removeClass("button-primary-disabled");var c=a("#crm_meta_company");return a("html, body").animate({scrollTop:c.offset().top-50},500),!1}}}),jQuery(document).on("change","#role",function(){var a=jQuery("#role").val();jQuery("#current_user_role").val();jQuery(".dxcrm-customer-row").hide(),jQuery(".crm-user-meta-details-wrp").hide(),jQuery(".dxcrm-customer-row").attr("disabled","disabled"),"dx_crm_customer"==a&&(jQuery(".crm-customer-select").removeAttr("disabled"),jQuery(".crm-user-meta-details-wrp").show(),jQuery(".dxcrm-customer-row").show())}),a(".crm_project_status").barrating("show",{onSelect:function(b,c){var d=b.split("_");project_status=d[0],post_id=d[1];var e={action:"crm_change_status",post_id:post_id,project_status:project_status};a.post(CrmSystem.ajaxurl,e,function(a){})}}),a(document).on("click",".dx-crm-add-customer-link",function(){return a(".dx-crm-cust-title-error").hide(),a(".dx-crm-cust-email-error").hide(),a(".dx-crm-cust-title-success").hide(),a(".dx_crm_customer_title_text").val(""),a(".dx_crm_customer_email_text").val(""),a(".dx-crm-cust-popup-content").fadeIn("slow"),a(".dx-crm-cust-popup-overlay").fadeIn("slow"),a("html,body").animate({scrollTop:0},800),!1}),a(document).on("click",".dx-crm-cust-close-button, .dx-crm-cust-popup-overlay",function(){a(".dx-crm-cust-popup-overlay").fadeOut(),a(".dx-crm-cust-popup-content").fadeOut()}),a(document).on("click",".dx_crm_add_customer_button",function(){a(".dx-crm-cust-title-error").hide(),a(".dx-crm-cust-email-error").hide(),a(".dx-crm-cust-title-success").hide();var b=a.trim(a(".dx_crm_customer_title_text").val()),c=a.trim(a(".dx_crm_customer_email_text").val());if(""!=b&&""!=c){var d={action:"crm_add_customer",customer_title:b,customer_email:c};a.post(CrmSystem.ajaxurl,d,function(b){var c=JSON.parse(b);c.success&&(a(".dx-crm-cust-popup-overlay").fadeOut(),a(".dx-crm-cust-popup-content").fadeOut(),a("select#dxcrm_joined_customer").append('<option value="'+c.post_id+'">'+c.customer_title+"</option>"),a(".dx_crm_custom_select_customers_list").trigger("chosen:updated"),a("select#dxcrm_joined_pro_customer").append('<option value="'+c.post_id+'">'+c.customer_title+"</option>"),a(".dx_crm_custom_select_customers_list").trigger("chosen:updated"),a("#dashboard-widgets-wrap").load(window.location.href+" #dashboard-widgets-wrap"))})}else""==b&&a(".dx-crm-cust-title-error").show(),""==c&&a(".dx-crm-cust-email-error").show();return!1}),a(document).on("click",".dx_crm_add_more_customer_button",function(){a(".dx-crm-cust-title-error").hide(),a(".dx-crm-cust-email-error").hide(),a(".dx-crm-cust-title-success").hide();var b=a.trim(a(".dx_crm_customer_title_text").val()),c=a.trim(a(".dx_crm_customer_email_text").val());if(""!=b&&""!=c){var d={action:"crm_add_customer",customer_title:b,customer_email:c};a.post(CrmSystem.ajaxurl,d,function(b){var c=JSON.parse(b);c.success&&(a(".dx_crm_customer_title_text").val(""),a(".dx_crm_customer_email_text").val(""),a(".dx-crm-cust-title-success").show(),a("select#dxcrm_joined_customer").append('<option value="'+c.post_id+'">'+c.customer_title+"</option>"),a(".dx_crm_custom_select_customers_list").trigger("chosen:updated"),a("select#dxcrm_joined_pro_customer").append('<option value="'+c.post_id+'">'+c.customer_title+"</option>"),a(".dx_crm_custom_select_customers_list").trigger("chosen:updated"),a("#dashboard-widgets-wrap").load(window.location.href+" #dashboard-widgets-wrap"))})}else""==b&&a(".dx-crm-cust-title-error").show(),""==c&&a(".dx-crm-cust-email-error").show();return!1}),a(document).on("click",".dx-crm-add-company-link",function(){return a(".dx-crm-comp-title-error").hide(),a(".dx-crm-comp-title-success").hide(),a(".dx_crm_company_title_text").val(""),a(".dx-crm-comp-popup-content").fadeIn("slow"),a(".dx-crm-comp-popup-overlay").fadeIn("slow"),a("html,body").animate({scrollTop:0},800),!1}),a(document).on("click",".dx-crm-comp-close-button, .dx-crm-comp-popup-overlay",function(){a(".dx-crm-comp-popup-overlay").fadeOut(),a(".dx-crm-comp-popup-content").fadeOut()}),a(document).on("click",".dx_crm_add_company_button",function(){a(".dx-crm-comp-title-error").hide(),a(".dx-crm-comp-title-success").hide();var b=a.trim(a(".dx_crm_company_title_text").val());if(""!=b){var c={action:"crm_add_company",company_title:b};a.post(CrmSystem.ajaxurl,c,function(b){var c=JSON.parse(b);c.success&&(a(".dx-crm-comp-popup-overlay").fadeOut(),a(".dx-crm-comp-popup-content").fadeOut(),a("select#dxcrm_joined_company").append('<option value="'+c.post_id+'">'+c.company_title+"</option>"),a(".dx_crm_custom_select_company").trigger("chosen:updated"),a("#dashboard-widgets-wrap").load(window.location.href+" #dashboard-widgets-wrap"))})}else a(".dx-crm-comp-title-error").show();return!1}),a(document).on("click",".dx_crm_add_more_company_button",function(){a(".dx-crm-comp-title-error").hide(),a(".dx-crm-comp-title-success").hide();var b=a.trim(a(".dx_crm_company_title_text").val());if(""!=b){var c={action:"crm_add_company",company_title:b};a.post(CrmSystem.ajaxurl,c,function(b){var c=JSON.parse(b);c.success&&(a(".dx_crm_company_title_text").val(""),a(".dx-crm-comp-title-success").show(),a("select#dxcrm_joined_company").append('<option value="'+c.post_id+'">'+c.company_title+"</option>"),a(".dx_crm_custom_select_company").trigger("chosen:updated"),a("#dashboard-widgets-wrap").load(window.location.href+" #dashboard-widgets-wrap"))})}else a(".dx-crm-comp-title-error").show();return!1}),a(document).on("click",".dx-crm-add-project-link",function(){return a(".dx-crm-pro-title-error").hide(),a(".dx-crm-pro-title-success").hide(),a(".dx_crm_project_title_text").val(""),a(".dx-crm-pro-popup-content").fadeIn("slow"),a(".dx-crm-pro-popup-overlay").fadeIn("slow"),a("html,body").animate({scrollTop:0},800),!1}),a(document).on("click",".dx-crm-pro-close-button, .dx-crm-pro-popup-overlay",function(){a(".dx-crm-pro-popup-overlay").fadeOut(),a(".dx-crm-pro-popup-content").fadeOut()}),a(document).on("click",".dx_crm_add_project_button",function(){a(".dx-crm-pro-title-error").hide(),a(".dx-crm-pro-title-success").hide();var b=a.trim(a(".dx_crm_project_title_text").val());if(""!=b){var c={action:"crm_add_project",title:b};a.post(CrmSystem.ajaxurl,c,function(b){var c=JSON.parse(b);c.success&&(a(".dx-crm-pro-popup-overlay").fadeOut(),a(".dx-crm-pro-popup-content").fadeOut(),a("select#dxcrm_joined_project").append('<option value="'+c.post_id+'">'+c.project_title+"</option>"),a(".dx_crm_custom_select_project_list").trigger("chosen:updated"),a("#dashboard-widgets-wrap").load(window.location.href+" #dashboard-widgets-wrap"))})}else a(".dx-crm-pro-title-error").show();return!1}),a(document).on("click",".dx_crm_add_more_project_button",function(){a(".dx-crm-pro-title-error").hide(),a(".dx-crm-pro-title-success").hide();var b=a.trim(a(".dx_crm_project_title_text").val());if(""!=b){var c={action:"crm_add_project",title:b};a.post(CrmSystem.ajaxurl,c,function(b){var c=JSON.parse(b);c.success&&(a(".dx_crm_project_title_text").val(""),a(".dx-crm-pro-title-success").show(),a("select#dxcrm_joined_project").append('<option value="'+c.post_id+'">'+c.project_title+"</option>"),a(".dx_crm_custom_select_project_list").trigger("chosen:updated"),a("#dashboard-widgets-wrap").load(window.location.href+" #dashboard-widgets-wrap"))})}else a(".dx-crm-pro-title-error").show();return!1}),a(document).on("click",".dx-crm-add-project-type",function(){return a(".dx-crm-pro-type-title-error").hide(),a(".dx-crm-pro-type-title-success").hide(),a(".dx_crm_project_type_title_text").val(""),a(".dx-crm-pro-type-popup-content").fadeIn("slow"),a(".dx-crm-pro-type-popup-overlay").fadeIn("slow"),a("html,body").animate({scrollTop:0},800),!1}),a(document).on("click",".dx-crm-pro-type-close-button, .dx-crm-pro-type-popup-overlay",function(){a(".dx-crm-pro-type-popup-overlay").fadeOut(),a(".dx-crm-pro-type-popup-content").fadeOut()}),a(document).on("click",".dx_crm_add_project_type_button",function(){a(".dx-crm-pro-type-title-error").hide(),a(".dx-crm-pro-type-title-success").hide();var b=a.trim(a(".dx_crm_project_type_title_text").val());if(""!=b){var c={action:"crm_add_project_type",title:b};a.post(CrmSystem.ajaxurl,c,function(b){var c=JSON.parse(b);c.success&&(a(".dx-crm-pro-type-popup-overlay").fadeOut(),a(".dx-crm-pro-type-popup-content").fadeOut(),a("select.dx_crm_custom_select_company_type").append('<option value="'+c.term_id+'">'+c.term_title+"</option>"),a(".dx_crm_custom_select_company_type").trigger("chosen:updated"))})}else a(".dx-crm-pro-type-title-error").show();return!1}),a(document).on("click",".dx_crm_add_more_project_type_button",function(){a(".dx-crm-pro-type-title-error").hide(),a(".dx-crm-pro-type-title-success").hide();var b=a.trim(a(".dx_crm_project_type_title_text").val());if(""!=b){var c={action:"crm_add_project_type",title:b};a.post(CrmSystem.ajaxurl,c,function(b){var c=JSON.parse(b);c.success&&(a(".dx_crm_project_type_title_text").val(""),a(".dx-crm-pro-type-title-success").show(),a("select.dx_crm_custom_select_company_type").append('<option value="'+c.term_id+'">'+c.term_title+"</option>"),a(".dx_crm_custom_select_company_type").trigger("chosen:updated"))})}else a(".dx-crm-pro-type-title-error").show();return!1}),a(document).on("click",".crm-dm-create-dir-button",function(){var a={action:"crm_dm_create_dir"};jQuery(this).html("Creating folder..."),jQuery.post(ajaxurl,a,function(a){"success"==a&&(jQuery("#crm_dm_dir_none").hide(),jQuery("#crm_dm_dir_exists").show())})}),a(".dx_crm_custom_select_company").length>0&&(a(".dx_crm_custom_select_company").chosen(),jQuery(".dx_crm_custom_select_company").ajaxChosen({method:"GET",url:ajaxurl,dataType:"json",minTermLength:2,data:{action:"dx_crm_ajax_company_list"}},function(a){var b={};return jQuery.each(a,function(a,c){b[a]=c}),b})),a(".dx_crm_custom_select_project_list").length>0&&(a(".dx_crm_custom_select_project_list").chosen(),jQuery(".dx_crm_custom_select_project_list").ajaxChosen({method:"GET",url:ajaxurl,dataType:"json",minTermLength:2,data:{action:"dx_crm_ajax_projects_list"}},function(a){var b={};return jQuery.each(a,function(a,c){b[a]=c}),b})),a(".dx_crm_custom_select_company_type").length>0&&(a(".dx_crm_custom_select_company_type").chosen(),jQuery(".dx_crm_custom_select_company_type").ajaxChosen({method:"GET",url:ajaxurl,dataType:"json",minTermLength:2,data:{action:"dx_crm_ajax_company_type_list"}},function(a){var b={};return jQuery.each(a,function(a,c){b[a]=c}),b})),a(".dx_crm_custom_select_customers_list").length>0&&(a(".dx_crm_custom_select_customers_list").chosen(),jQuery(".dx_crm_custom_select_customers_list").ajaxChosen({method:"GET",url:ajaxurl,dataType:"json",minTermLength:2,data:{action:"dx_crm_ajax_customers_list"}},function(a){var b={};return jQuery.each(a,function(a,c){b[a]=c}),b}))});